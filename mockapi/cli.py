FULL modified content of the cli.py file with improvements to caching logic